{% extends 'smart_rent/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card shadow border-0">
                <div class="card-body p-4">
                    <h3 class="fw-bold mb-4">
                        <i class="bi bi-person-plus me-2 text-primary"></i>Register New Tenant
                    </h3>
                    
                    <form method="POST" id="registrationForm">
                        {% csrf_token %}
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">{{ form.first_name|as_crispy_field }}</div>
                            <div class="col-md-6">{{ form.last_name|as_crispy_field }}</div>
                            <div class="col-12">{{ form.email|as_crispy_field }}</div>
                        </div>

                        <hr class="text-muted opacity-25">

                        <div class="row g-3">
                            <div class="col-md-6">{{ form.property|as_crispy_field }}</div>
                            <div class="col-md-6">{{ form.phone_number|as_crispy_field }}</div>
                            <div class="col-12">{{ form.rent_amount|as_crispy_field }}</div>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary rounded-pill py-2 fw-bold">
                                Create Account & Save Tenant
                            </button>
                            <a href="{% url 'dashboard' %}" class="btn btn-light rounded-pill text-muted">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="property-data" type="application/json">
    {
        {% for prop in properties %}
            "{{ prop.id }}": "{{ prop.price_per_month }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Parse data from the hidden JSON script to avoid IDE red lines
        const propertyPrices = JSON.parse(document.getElementById('property-data').textContent);
        
        const propertySelect = document.querySelector('#id_property');
        const rentInput = document.querySelector('#id_rent_amount');

        if (propertySelect && rentInput) {
            propertySelect.addEventListener('change', function() {
                const selectedId = this.value;
                // Automatically populate the rent field
                rentInput.value = propertyPrices[selectedId] || "0.00";
            });
        }
    });
</script>
{% endblock %}